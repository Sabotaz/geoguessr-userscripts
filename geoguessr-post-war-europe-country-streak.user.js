// ==UserScript==
// @name         GeoGuessr Post-War Europe Country Streak
// @description  Adds a country streak counter that uses European country borders from the post-war era, prior to the collapse of the Soviet Union
// @version      1.0
// @author       miraclewhips
// @match        *://*.geoguessr.com/*
// @icon         https://www.google.com/s2/favicons?domain=geoguessr.com
// @grant        none
// @run-at       document-start
// @require      https://miraclewhips.dev/geoguessr-event-framework/geoguessr-event-framework.min.js?v=3
// @require      https://miraclewhips.dev/geoguessr-event-framework/geoguessr-streak-framework.min.js?v=3
// @require      https://miraclewhips.dev/geoguessr-event-framework/utils/turf.min.js?v=2
// @copyright    2023, miraclewhips (https://github.com/miraclewhips)
// @license      MIT
// @downloadURL  https://github.com/miraclewhips/geoguessr-userscripts/raw/master/geoguessr-post-war-europe-country-streak.user.js
// @updateURL    https://github.com/miraclewhips/geoguessr-userscripts/raw/master/geoguessr-post-war-europe-country-streak.user.js
// ==/UserScript==

/* ------------------------------------------------------------------------------- */
/* ----- SETTINGS (MUST RELOAD PAGE FOR CHANGES TO TAKE EFFECT) ------------------ */
/* ------------------------------------------------------------------------------- */
const LANGUAGE = "en";   // ISO 639-1 language code - https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes
const CHALLENGE = true;  // Set to false to disable streaks on challenge links
const AUTOMATIC = true;  // Set to false for a manual counter (controlled by keyboard shortcuts only)

/* ------------------------------------------------------------------------------- */
/* ----- KEYBOARD SHORTCUTS (MUST RELOAD PAGE FOR CHANGES TO TAKE EFFECT) -------- */
/* ------------------------------------------------------------------------------- */
const KEYBOARD_SHORTCUTS = {
	reset: '0',     // reset streak to 0
	increment: '1', // increment streak by 1
	decrement: '2', // decrement streak by 1
	restore: '8',   // restore your streak to it's previous value
};



/* ############################################################################### */
/* ##### DON'T MODIFY ANYTHING BELOW HERE UNLESS YOU KNOW WHAT YOU ARE DOING ##### */
/* ############################################################################### */

const CUSTOM_POLYGONS = {"type":"FeatureCollection","features":[{"type":"Feature","id":92,"geometry":{"type":"MultiPolygon","coordinates":[[[[13.827082,54.142564],[13.822651,54.150049],[13.822651,54.15005],[13.821031,54.152786],[13.820342,54.15395],[13.812777,54.166733],[13.812775,54.166733],[13.812775,54.166734],[13.784424,54.166154],[13.782725,54.16612],[13.768471,54.165829],[13.758054,54.147358],[13.758056,54.147357],[13.758054,54.147354],[13.810809,54.104473],[13.810809,54.104473],[13.810809,54.104463],[13.808683,54.071613],[13.814303,54.057676],[13.822775,54.036662],[13.822776,54.036661],[13.822777,54.036659],[13.836925,54.022133],[13.859027,53.999437],[13.900417,54.011937],[13.919145,54.031574],[13.919145,54.031574],[13.919146,54.031574],[13.924101,54.059013],[13.945272,54.060097],[13.948878,54.06028],[13.950687,54.060373],[13.950689,54.060373],[13.954073,54.060545],[13.979881,54.056609],[13.979881,54.056609],[13.982767,54.053723],[13.986175,54.050314],[14.003283,54.033201],[14.014001,54.014174],[14.031875,54.009533],[14.04769,54.005424],[14.051596,53.995763],[14.056,53.984864],[14.047363,53.96263],[14.047363,53.96263],[14.039598,53.942645],[14.012691,53.949427],[14.012683,53.949428],[13.982067,53.962551],[13.97651,53.957688],[13.976508,53.957689],[13.974499,53.95593],[13.970951,53.952824],[13.957568,53.941113],[13.946601,53.925063],[13.944826,53.922468],[13.943945,53.921178],[13.943931,53.921155],[13.939631,53.914864],[13.929215,53.897581],[13.929164,53.8975],[13.871945,53.878054],[13.829194,53.859508],[13.829196,53.859508],[13.829189,53.859505],[13.885277,53.840134],[13.949165,53.843605],[14.000277,53.851799],[14.018481,53.860174],[14.018481,53.860174],[14.018481,53.860174],[14.018481,53.860174],[14.018481,53.860174],[14.039373,53.869783],[14.0825,53.873328],[14.120583,53.873901],[14.193472,53.874996],[14.218887,53.869019],[14.218887,53.869019],[14.218889,53.869019],[14.217627,53.881799],[14.215832,53.899994],[14.225555,53.928604],[14.214167,53.932495],[14.184027,53.946384],[14.105,53.998604],[14.057377,54.029266],[14.057377,54.029266],[14.001318,54.065363],[13.965445,54.073236],[13.92979,54.079581],[13.929764,54.07959],[13.892382,54.0903],[13.88661,54.093895],[13.88661,54.093895],[13.885451,54.094617],[13.883057,54.096108],[13.86611,54.106667],[13.841213,54.129566],[13.827082,54.142564]]],[[[12.365694,54.305204],[12.425833,54.372498],[12.463888,54.395134],[12.643222,54.413887],[12.6641,54.414444],[12.6641,54.414444],[12.666845,54.414516],[12.668156,54.414551],[12.668158,54.414552],[12.670691,54.414619],[12.703799,54.429672],[12.729239,54.423363],[12.729239,54.423363],[12.730407,54.422949],[12.730408,54.422949],[12.730968,54.42275],[12.732277,54.422286],[12.758337,54.413044],[12.880554,54.411942],[12.921527,54.42746],[12.921523,54.427463],[12.921524,54.427463],[12.908763,54.436586],[12.908114,54.43705],[12.900692,54.442356],[12.861116,54.442413],[12.861116,54.442413],[12.861116,54.442413],[12.803335,54.442499],[12.680774,54.444944],[12.680682,54.44495],[12.664042,54.445903],[12.660443,54.44611],[12.6534,54.447024],[12.638669,54.448937],[12.63861,54.448945],[12.616733,54.451162],[12.616733,54.451162],[12.540554,54.458885],[12.536601,54.463321],[12.536601,54.463321],[12.53337,54.466949],[12.526945,54.474163],[12.480554,54.444163],[12.436945,54.391108],[12.436938,54.391101],[12.355121,54.308503],[12.355123,54.308502],[12.349863,54.303191],[12.335482,54.29282],[12.326945,54.286663],[12.129719,54.191109],[11.98611,54.173335],[11.7475,54.15639],[11.715924,54.15474],[11.695573,54.153676],[11.626161,54.105156],[11.62616,54.10515],[11.626354,54.082391],[11.625032,54.081108],[11.625032,54.081108],[11.624408,54.080502],[11.576809,54.0343],[11.554718,54.026936],[11.544718,54.026382],[11.522099,54.033259],[11.522082,54.033263],[11.492774,53.994581],[11.488572,53.982506],[11.480836,53.960273],[11.456707,53.945896],[11.456707,53.945896],[11.412774,53.919718],[11.258319,53.93799],[11.251627,53.938782],[11.183536,54.011936],[11.094718,54.013609],[11.094514,54.013577],[11.053632,54.006852],[11.045222,54.004454],[11.013054,53.995281],[10.964719,53.980272],[10.964662,53.980252],[10.904436,53.957345],[10.898891,53.931109],[10.88081,53.921871],[10.867164,53.908638],[10.892793,53.82095],[10.827507,53.742029],[10.820712,53.718484],[10.947741,53.620841],[10.835103,53.526829],[10.813953,53.436437],[10.878461,53.21378],[11.047065,53.122532],[11.006662,53.024368],[10.720949,52.939143],[10.717428,52.857495],[10.765014,52.753789],[10.752216,52.683939],[10.728428,52.639728],[10.69812,52.614142],[10.668107,52.480508],[10.652644,52.430588],[10.568953,52.268241],[10.621535,52.190643],[10.64461,52.175594],[10.640403,52.129303],[10.613879,52.062221],[10.538934,52.034477],[10.310413,51.990564],[10.21205,51.988253],[10.192359,51.973235],[10.181369,51.913186],[10.173461,51.863558],[10.160416,51.338777],[10.139983,51.258458],[10.170078,51.201126],[10.194368,51.226348],[10.243838,51.226348],[10.267215,51.172472],[10.289714,50.897793],[10.32439,50.85094],[10.445365,50.833804],[10.630871,50.70252],[10.7096,50.631808],[10.797721,50.59419],[10.914663,50.401744],[10.972666,50.336914],[11.074304,50.325544],[11.105576,50.350559],[11.113589,50.38468],[11.089867,50.430191],[11.062634,50.555445],[11.129624,50.545192],[11.188677,50.528105],[11.254032,50.518993],[11.352204,50.467752],[11.410849,50.448401],[11.453759,50.416536],[11.463871,50.388093],[11.560519,50.327818],[11.596262,50.333502],[11.572583,50.504187],[11.570167,50.613567],[11.606149,50.658034],[11.651289,50.667158],[11.752229,50.573676],[11.812136,50.41426],[11.907807,50.373305],[11.988379,50.361931],[12.083958,50.333502],[12.099272,50.321366],[12.182637,50.314581],[12.201044,50.296615],[12.281109,50.218465],[12.323054,50.206664],[12.32554,50.235943],[12.398609,50.309164],[12.431786,50.333389],[12.486325,50.373197],[12.515418,50.392492],[12.570438,50.402631],[12.620973,50.411944],[12.671391,50.411944],[12.697582,50.419372],[12.748367,50.434888],[12.772219,50.444999],[12.803151,50.449703],[12.833059,50.450251],[12.855836,50.442217],[12.898801,50.425013],[12.917617,50.41465],[12.944719,50.409999],[12.98875,50.419718],[13.015274,50.4393],[13.051036,50.472043],[13.079445,50.498054],[13.187219,50.502773],[13.201533,50.516137],[13.223227,50.551419],[13.249582,50.589164],[13.378336,50.629437],[13.423057,50.609086],[13.463401,50.601664],[13.511749,50.641708],[13.541639,50.689972],[13.582219,50.709444],[13.614916,50.7174],[13.634719,50.722219],[13.669445,50.725828],[13.734164,50.730827],[13.787937,50.743866],[13.891109,50.768882],[13.903599,50.788175],[13.924884,50.794605],[13.990692,50.814444],[14.082255,50.830329],[14.155554,50.843046],[14.311391,50.882218],[14.325119,50.894945],[14.368328,50.935],[14.321246,50.946109],[14.258054,50.995136],[14.285554,51.0375],[14.306034,51.052338],[14.381138,51.046098],[14.491664,51.036663],[14.551159,51.012781],[14.569164,51.005554],[14.597219,50.9825],[14.606296,50.965321],[14.628335,50.923609],[14.63139,50.881101],[14.619236,50.858255],[14.651664,50.847219],[14.690843,50.83652],[14.717781,50.829164],[14.739161,50.824016],[14.771527,50.818327],[14.802435,50.819697],[14.82667,50.861111],[14.82618,50.883053],[14.896944,50.959443],[14.93111,51.002493],[14.965555,51.052217],[14.978889,51.07833],[14.994444,51.118608],[15.03222,51.239165],[15.033818,51.286661],[15.002637,51.3168],[14.983334,51.33361],[14.97675,51.362634],[14.975555,51.440827],[14.953054,51.469993],[14.92111,51.481943],[14.8375,51.498602],[14.739444,51.526525],[14.714999,51.55472],[14.759236,51.607493],[14.75611,51.666734],[14.722082,51.690966],[14.698055,51.702217],[14.667984,51.723884],[14.600972,51.820064],[14.610137,51.848191],[14.645416,51.865275],[14.689861,51.896943],[14.717552,51.943111],[14.760764,52.069863],[14.700207,52.250029],[14.655834,52.260275],[14.598888,52.272774],[14.579861,52.288329],[14.534444,52.396247],[14.543956,52.421872],[14.563193,52.43319],[14.585137,52.439856],[14.633539,52.490552],[14.639582,52.57298],[14.595779,52.606829],[14.554582,52.627219],[14.514444,52.639164],[14.478748,52.652498],[14.44833,52.675279],[14.383334,52.730827],[14.355,52.748328],[14.205417,52.818608],[14.149165,52.862779],[14.147637,52.959234],[14.168889,52.973327],[14.200279,52.984718],[14.225416,52.988883],[14.293738,53.01877],[14.347362,53.048884],[14.380275,53.110135],[14.39169,53.144165],[14.412776,53.304444],[14.413262,53.338957],[14.30972,53.555548],[14.275628,53.699064],[14.275627,53.699064],[14.275627,53.699064],[14.256391,53.697354],[14.223891,53.700827],[13.959163,53.774991],[13.808536,53.854782],[13.821109,53.876391],[13.865273,53.904164],[13.829718,53.986382],[13.806403,54.020395],[13.78611,54.049997],[13.786111,54.049998],[13.786109,54.05],[13.799026,54.084162],[13.799024,54.084171],[13.788891,54.109718],[13.710829,54.170826],[13.484028,54.119443],[13.499718,54.086109],[13.487082,54.087354],[13.461549,54.094997],[13.461548,54.094997],[13.461548,54.094997],[13.454582,54.097082],[13.379163,54.174436],[13.328856,54.206767],[13.285137,54.234863],[13.232505,54.247234],[13.232505,54.247234],[13.2125,54.251936],[13.118609,54.276454],[13.095781,54.306163],[13.02389,54.399718],[12.935728,54.390459],[12.764719,54.372499],[12.682781,54.376108],[12.621314,54.372419],[12.619587,54.37224],[12.581945,54.368327],[12.549718,54.360545],[12.480136,54.331936],[12.421426,54.283327],[12.420701,54.282728],[12.423956,54.258954],[12.4516,54.249718],[12.451596,54.249718],[12.451596,54.249718],[12.408193,54.248745],[12.408193,54.248745],[12.408191,54.248745],[12.374373,54.262427],[12.365838,54.304476],[12.365841,54.304475],[12.365693,54.305202],[12.365694,54.305204]]],[[[13.51562,54.51189],[13.503091,54.493099],[13.489606,54.486536],[13.489606,54.486536],[13.483854,54.483738],[13.447462,54.488937],[13.420427,54.521691],[13.394954,54.541964],[13.377799,54.558082],[13.377799,54.558086],[13.368931,54.577145],[13.368929,54.577145],[13.367397,54.580437],[13.337764,54.566402],[13.30397,54.550285],[13.25562,54.551323],[13.239412,54.552109],[13.231394,54.5525],[13.23139,54.5525],[13.146964,54.545608],[13.146966,54.545605],[13.146962,54.545605],[13.165275,54.516492],[13.165275,54.516492],[13.167236,54.513373],[13.167237,54.513373],[13.167238,54.513371],[13.232224,54.485817],[13.230404,54.475326],[13.22861,54.464999],[13.188658,54.445856],[13.164639,54.434349],[13.164643,54.434348],[13.164638,54.434346],[13.198477,54.429455],[13.207789,54.428108],[13.238983,54.411473],[13.240496,54.40956],[13.240497,54.409559],[13.240497,54.409559],[13.263887,54.379999],[13.263877,54.379996],[13.252519,54.376621],[13.235832,54.371666],[13.226974,54.370566],[13.220136,54.369718],[13.200557,54.372773],[13.200554,54.372773],[13.182809,54.373727],[13.182808,54.373727],[13.154027,54.375275],[13.133957,54.371384],[13.133956,54.371383],[13.133955,54.371382],[13.125358,54.3517],[13.118818,54.336731],[13.118819,54.33673],[13.118818,54.336728],[13.15611,54.305546],[13.156271,54.30547],[13.253332,54.257217],[13.268055,54.254997],[13.317734,54.248714],[13.318609,54.248601],[13.354645,54.235963],[13.395416,54.221661],[13.426944,54.235828],[13.427638,54.247913],[13.420971,54.260273],[13.41396,54.262702],[13.413959,54.262704],[13.413952,54.262705],[13.413952,54.262705],[13.406943,54.265133],[13.395794,54.263912],[13.395783,54.263913],[13.376779,54.261831],[13.376779,54.261831],[13.3575,54.25972],[13.357539,54.263562],[13.357565,54.266189],[13.357565,54.266189],[13.357638,54.27319],[13.400376,54.294267],[13.400376,54.294267],[13.469427,54.328318],[13.469445,54.328328],[13.501131,54.34024],[13.506389,54.342216],[13.686944,54.348743],[13.712499,54.322636],[13.710833,54.296944],[13.699308,54.28583],[13.695345,54.282009],[13.695347,54.282009],[13.695347,54.282009],[13.713055,54.271938],[13.721109,54.273536],[13.721109,54.273536],[13.721109,54.273536],[13.729166,54.275135],[13.743886,54.331097],[13.743891,54.331109],[13.73638,54.344982],[13.73638,54.344983],[13.73111,54.354721],[13.710693,54.38097],[13.706598,54.38451],[13.706596,54.384513],[13.706594,54.384514],[13.702499,54.388054],[13.671409,54.401518],[13.67139,54.401527],[13.671388,54.401527],[13.671388,54.401527],[13.646387,54.401382],[13.642994,54.401321],[13.642994,54.401321],[13.631109,54.401109],[13.625069,54.402218],[13.625068,54.402218],[13.625068,54.402218],[13.622875,54.402621],[13.619026,54.403328],[13.618643,54.403743],[13.616075,54.406522],[13.583611,54.441666],[13.577284,54.456936],[13.577311,54.460635],[13.577311,54.460635],[13.577323,54.462145],[13.577323,54.462146],[13.577323,54.462146],[13.577363,54.467354],[13.587362,54.483189],[13.587362,54.48319],[13.644166,54.51416],[13.66861,54.521523],[13.672564,54.525476],[13.672568,54.525478],[13.67257,54.525482],[13.676527,54.529438],[13.679165,54.542496],[13.674513,54.566593],[13.64763,54.580268],[13.638473,54.584927],[13.617774,54.586108],[13.593054,54.584718],[13.51609,54.576799],[13.485219,54.574927],[13.481774,54.574718],[13.4563,54.573158],[13.433424,54.577839],[13.40743,54.588757],[13.391313,54.606953],[13.384305,54.641941],[13.389096,54.646314],[13.389096,54.646314],[13.389097,54.646315],[13.393891,54.650691],[13.41014,54.654754],[13.41014,54.654754],[13.425554,54.658607],[13.441596,54.674786],[13.427082,54.682499],[13.383888,54.680832],[13.369186,54.679782],[13.364445,54.679445],[13.364208,54.679423],[13.292221,54.673332],[13.285477,54.672368],[13.285414,54.672363],[13.285385,54.672355],[13.27861,54.671387],[13.263332,54.666664],[13.256323,54.662897],[13.244719,54.656664],[13.226527,54.641181],[13.226528,54.641179],[13.226527,54.641178],[13.24875,54.557777],[13.282365,54.563974],[13.284136,54.5643],[13.284136,54.5643],[13.28732,54.565388],[13.287321,54.565388],[13.310555,54.573326],[13.329721,54.582771],[13.35544,54.604355],[13.374673,54.610072],[13.375427,54.607372],[13.375429,54.607372],[13.383514,54.578358],[13.426146,54.570042],[13.459401,54.550814],[13.459418,54.550801],[13.502571,54.549765],[13.502571,54.549765],[13.516607,54.513371],[13.51562,54.51189]]]]},"properties":{"name":"German Democratic Republic","area_km2":109254.59,"capname":"East Berlin","caplong":13.402665,"caplat":52.51783,"gwsdate":"1949-10-05","gwedate":"1990-10-02","gwcode":265},"links":[{"href":"https://demo.ldproxy.net/cshapes/collections/boundary/items/92?f=json","rel":"self","type":"application/geo+json","title":"This document"},{"href":"https://demo.ldproxy.net/cshapes/collections/boundary/items/92?f=jsonfgc","rel":"alternate","type":"application/vnd.ogc.fg+json;compatibility=geojson","title":"This document as JSON-FG (GeoJSON Compatibility Mode)"},{"href":"https://demo.ldproxy.net/cshapes/collections/boundary/items/92?f=csv","rel":"alternate","type":"text/csv","title":"This document as CSV"},{"href":"https://demo.ldproxy.net/cshapes/collections/boundary/items/92?f=fgb","rel":"alternate","type":"application/flatgeobuf","title":"This document as FlatGeobuf"},{"href":"https://demo.ldproxy.net/cshapes/collections/boundary/items/92?f=html","rel":"alternate","type":"text/html","title":"This document as HTML"},{"href":"https://demo.ldproxy.net/cshapes/collections/boundary/items/92?f=jsonfg","rel":"alternate","type":"application/vnd.ogc.fg+json","title":"This document as JSON-FG"},{"href":"https://demo.ldproxy.net/cshapes/collections/boundary?f=json","rel":"collection","type":"application/json","title":"The collection the feature belongs to"}]},{"type":"Feature","id":89,"geometry":{"type":"MultiPolygon","coordinates":[[[[8.692773,54.895827],[8.664545,54.913091],[8.633816,54.911979],[8.600482,54.910772],[8.559431,54.90696],[8.490463,54.900554],[8.461218,54.899973],[8.461215,54.899975],[8.461215,54.899975],[8.420421,54.919644],[8.420421,54.919644],[8.420418,54.919645],[8.397954,54.935172],[8.353193,54.966107],[8.353194,54.966108],[8.353191,54.966109],[8.371115,54.992923],[8.371382,54.993322],[8.371382,54.993322],[8.371945,54.994164],[8.407636,55.0093],[8.438327,55.024164],[8.454234,55.05097],[8.408054,55.056527],[8.388192,55.049164],[8.374731,55.034822],[8.373556,55.03357],[8.361384,55.015208],[8.307219,54.933054],[8.302766,54.922631],[8.296444,54.907829],[8.294428,54.849394],[8.299786,54.851074],[8.3009,54.856454],[8.326582,54.859472],[8.390109,54.866937],[8.464504,54.868693],[8.545609,54.870609],[8.576182,54.857382],[8.641391,54.832218],[8.650113,54.809821],[8.650519,54.808779],[8.696945,54.746937],[8.717233,54.732963],[8.734445,54.721109],[8.754445,54.711664],[8.774112,54.699277],[8.809582,54.676937],[8.850828,54.620827],[8.883167,54.592453],[8.925617,54.557517],[8.934823,54.552601],[8.943609,54.54791],[8.964027,54.542355],[9.011246,54.503465],[9.01126,54.503305],[9.013954,54.474991],[9.012987,54.473833],[8.994719,54.451944],[8.886945,54.414164],[8.868502,54.410321],[8.844927,54.405409],[8.826527,54.414718],[8.826434,54.414712],[8.760769,54.409973],[8.737209,54.407407],[8.642428,54.397081],[8.620354,54.374437],[8.600483,54.326382],[8.613811,54.301219],[8.637637,54.276101],[8.647042,54.273108],[8.656065,54.270238],[8.690187,54.267565],[8.690209,54.267564],[8.801607,54.288094],[8.83,54.293327],[8.883608,54.294165],[8.883608,54.294164],[8.883609,54.294164],[8.845627,54.254164],[8.845573,54.254047],[8.818031,54.192507],[8.818019,54.192468],[8.813229,54.17427],[8.813445,54.173925],[8.827363,54.151664],[8.852363,54.127982],[8.971109,54.131664],[8.998968,54.10347],[9.017219,54.085],[9.017211,54.08495],[9.011945,54.046936],[9.001806,54.027094],[9.001801,54.027082],[8.990085,54.023196],[8.975,54.018191],[8.953054,54.026382],[8.946863,54.028924],[8.918281,54.038752],[8.877177,54.04267],[8.866834,54.040182],[8.844273,54.034753],[8.85,54.008891],[8.883054,53.961109],[8.900032,53.942241],[8.903195,53.938725],[8.927461,53.919746],[8.9275,53.919718],[8.930793,53.91766],[8.947554,53.907196],[8.947705,53.907133],[8.984163,53.891873],[9.031404,53.895569],[9.063054,53.898046],[9.17815,53.891656],[9.213054,53.889718],[9.234445,53.886382],[9.246632,53.883628],[9.282363,53.875554],[9.332773,53.855],[9.371306,53.834547],[9.393746,53.822636],[9.407774,53.792219],[9.417219,53.771109],[9.434164,53.744019],[9.510935,53.669392],[9.553891,53.627636],[9.575282,53.613609],[9.672782,53.575273],[9.672871,53.57525],[9.701936,53.568447],[9.732606,53.565278],[9.741082,53.565],[9.779027,53.562082],[9.829063,53.5417],[9.82906,53.541699],[9.82906,53.541699],[9.829052,53.541696],[9.809373,53.533745],[9.808772,53.53388],[9.808772,53.53388],[9.808493,53.533942],[9.764745,53.543727],[9.730658,53.54697],[9.695835,53.550281],[9.686551,53.552402],[9.672782,53.555545],[9.618513,53.57446],[9.577918,53.588609],[9.569547,53.59439],[9.555,53.604436],[9.518394,53.636019],[9.412362,53.727499],[9.379445,53.760827],[9.345617,53.804042],[9.341862,53.807942],[9.322362,53.828192],[9.2834,53.855545],[9.215973,53.864854],[9.128891,53.8661],[9.106508,53.863472],[9.10611,53.863425],[9.022169,53.846982],[9.020554,53.846664],[8.9075,53.828045],[8.853054,53.829718],[8.797218,53.835827],[8.777346,53.840163],[8.776757,53.840292],[8.776756,53.840292],[8.775554,53.840554],[8.756424,53.846654],[8.75639,53.846664],[8.711599,53.870344],[8.682219,53.89389],[8.652929,53.891111],[8.651794,53.890827],[8.604582,53.879018],[8.589963,53.866118],[8.573442,53.850093],[8.572703,53.849168],[8.548054,53.818327],[8.548042,53.818301],[8.485633,53.677787],[8.488721,53.660602],[8.490828,53.648883],[8.501745,53.632348],[8.511736,53.617218],[8.536455,53.576696],[8.565518,53.529054],[8.563191,53.522246],[8.563191,53.522245],[8.563191,53.522245],[8.560863,53.515436],[8.504373,53.483191],[8.497363,53.456527],[8.505418,53.429718],[8.503891,53.362354],[8.503673,53.362585],[8.503673,53.362585],[8.503573,53.362691],[8.489718,53.377354],[8.484718,53.412218],[8.484027,53.462082],[8.494927,53.489236],[8.513334,53.50958],[8.513335,53.509582],[8.494445,53.554991],[8.332218,53.615273],[8.31124,53.616617],[8.309423,53.616733],[8.291335,53.613121],[8.263535,53.602617],[8.254573,53.595393],[8.243054,53.586108],[8.236945,53.557782],[8.233682,53.52312],[8.268192,53.520274],[8.305,53.524855],[8.309613,53.51889],[8.319927,53.505554],[8.311873,53.45632],[8.311873,53.456317],[8.286038,53.420893],[8.286038,53.420893],[8.286036,53.420891],[8.246245,53.4018],[8.234445,53.400554],[8.210273,53.403045],[8.117543,53.43717],[8.097775,53.444444],[8.097774,53.444445],[8.097773,53.444445],[8.072982,53.468191],[8.062427,53.5009],[8.093745,53.503054],[8.093868,53.503077],[8.132083,53.511079],[8.143412,53.516922],[8.166599,53.528883],[8.163827,53.544315],[8.162267,53.552997],[8.12389,53.584718],[8.089043,53.607364],[8.052082,53.631382],[8.035874,53.666188],[8.024963,53.689617],[8.014308,53.708327],[7.988472,53.713824],[7.98491,53.714582],[7.949164,53.7175],[7.9075,53.719445],[7.8825,53.7175],[7.867736,53.716243],[7.850986,53.714816],[7.782037,53.708292],[7.698335,53.700273],[7.581664,53.681391],[7.513473,53.672081],[7.487169,53.680246],[7.468745,53.685964],[7.40977,53.687186],[7.341109,53.688608],[7.294806,53.684981],[7.289231,53.683403],[7.232082,53.667218],[7.184719,53.642218],[7.093537,53.58819],[7.057371,53.525621],[7.032363,53.482354],[7.021945,53.4425],[7.015,53.409855],[7.018955,53.375345],[7.049928,53.341109],[7.082918,53.337082],[7.126391,53.34],[7.183891,53.340827],[7.226945,53.336391],[7.337082,53.323054],[7.3509,53.307254],[7.324863,53.316936],[7.255836,53.316036],[7.234189,53.282646],[7.208363,53.242809],[7.207576,53.242569],[7.207575,53.242568],[7.207219,53.176109],[7.210024,53.051157],[7.210972,53.008884],[7.194487,52.959583],[7.179719,52.934165],[7.162,52.91697],[7.127709,52.882267],[7.091064,52.836909],[7.073028,52.816065],[7.066246,52.792499],[7.064955,52.75907],[7.06361,52.721382],[7.057111,52.675353],[7.053472,52.649581],[7.033746,52.633191],[7.012736,52.63565],[6.906215,52.64812],[6.765763,52.651176],[6.723767,52.623278],[6.746943,52.584528],[6.758125,52.564647],[6.7225,52.55944],[6.695669,52.552196],[6.704027,52.488192],[6.758891,52.460965],[6.930518,52.440101],[6.954243,52.437223],[6.984027,52.457354],[7.062983,52.390964],[7.069798,52.358757],[7.058115,52.337639],[7.037178,52.308653],[7.030698,52.285568],[7.047076,52.238761],[6.964721,52.190277],[6.906036,52.173207],[6.891422,52.160068],[6.87015,52.1367],[6.856038,52.120483],[6.812699,52.117827],[6.759427,52.114564],[6.740171,52.082883],[6.732549,52.056231],[6.72861,52.035272],[6.762778,52.022116],[6.7975,52.008746],[6.823899,51.970133],[6.775127,51.920696],[6.746391,51.906108],[6.728296,51.899899],[6.70408,51.904604],[6.684654,51.911664],[6.642823,51.904429],[6.591552,51.895089],[6.5275,51.874445],[6.462781,51.853609],[6.351109,51.848054],[6.182219,51.895273],[6.123609,51.888054],[6.09532,51.874429],[6.003055,51.829994],[5.971758,51.808028],[5.978257,51.764339],[5.952054,51.747528],[5.987986,51.728418],[6.028889,51.706665],[6.06794,51.645823],[6.093609,51.605827],[6.134027,51.570827],[6.158609,51.558327],[6.182784,51.534879],[6.204861,51.513466],[6.213671,51.489878],[6.222082,51.467355],[6.222233,51.429821],[6.222499,51.36319],[6.143054,51.295273],[6.077637,51.241382],[6.071664,51.214091],[6.08181,51.182473],[6.095226,51.138621],[6.055885,51.110419],[6.003054,51.084163],[5.905554,51.063118],[5.865,51.045343],[5.873041,51.013828],[5.902012,50.973118],[5.943749,50.984299],[6.024928,50.977982],[6.050432,50.949123],[6.080833,50.914719],[6.077836,50.86665],[6.052181,50.849212],[6.016664,50.841663],[6.00824,50.799995],[6.011798,50.757271],[6.03446,50.739499],[6.054719,50.723609],[6.129521,50.678915],[6.167222,50.656388],[6.265574,50.61329],[6.247774,50.589164],[6.264721,50.497773],[6.288193,50.497506],[6.313473,50.497218],[6.339164,50.486937],[6.371604,50.445486],[6.389645,50.321338],[6.34972,50.312774],[6.280836,50.283609],[6.166664,50.224718],[6.139719,50.154444],[6.125963,50.127839],[6.121213,50.098361],[6.113313,50.058992],[6.130554,50.013883],[6.145222,49.987949],[6.174164,49.951109],[6.234164,49.8975],[6.252781,49.882355],[6.295329,49.86414],[6.318523,49.851822],[6.367902,49.829122],[6.401001,49.816355],[6.429719,49.808882],[6.481945,49.811101],[6.524027,49.8077],[6.505835,49.706627],[6.47346,49.693368],[6.420835,49.665834],[6.356487,49.525864],[6.362778,49.489166],[6.36217,49.45939],[6.410979,49.474817],[6.435405,49.470017],[6.468334,49.461388],[6.514517,49.439224],[6.541245,49.423882],[6.594718,49.363054],[6.688315,49.242182],[6.715069,49.187287],[6.729236,49.167633],[6.784027,49.161067],[6.8341,49.155064],[6.85534,49.182827],[6.846076,49.212044],[6.872739,49.21464],[6.929863,49.2202],[7.020584,49.18653],[7.090554,49.127491],[7.151663,49.121109],[7.231684,49.115635],[7.289721,49.111664],[7.318445,49.127233],[7.372566,49.166359],[7.425555,49.176453],[7.486944,49.164162],[7.586902,49.095491],[7.628054,49.067218],[7.64844,49.048321],[7.668891,49.042218],[7.704569,49.042507],[7.737499,49.042771],[7.821389,49.046387],[7.935972,49.048882],[8.004053,49.023665],[8.049565,49.007108],[8.155554,48.976388],[8.226078,48.964417],[8.198327,48.955418],[8.150686,48.90668],[8.134582,48.887999],[8.121663,48.865],[8.112378,48.845666],[8.107116,48.827092],[8.09222,48.803603],[8.055739,48.781357],[7.961945,48.724164],[7.88,48.664164],[7.802218,48.575827],[7.7454,48.424945],[7.736663,48.394027],[7.743698,48.367088],[7.748706,48.335792],[7.693333,48.276382],[7.607121,48.163212],[7.578379,48.117199],[7.569306,48.087219],[7.570397,48.047565],[7.584907,48.02635],[7.619769,47.996525],[7.622635,47.976874],[7.584163,47.903327],[7.557218,47.862782],[7.526663,47.788054],[7.512082,47.695136],[7.527636,47.662427],[7.564163,47.639164],[7.576588,47.618836],[7.587318,47.59168],[7.640555,47.603882],[7.67569,47.604996],[7.668974,47.576692],[7.621113,47.561101],[7.652849,47.551536],[7.680623,47.546949],[7.704366,47.545945],[7.769719,47.553328],[7.917709,47.554228],[7.976984,47.555192],[8.033333,47.556107],[8.101839,47.571072],[8.195763,47.620343],[8.222461,47.619807],[8.240836,47.619437],[8.289099,47.609091],[8.390835,47.579992],[8.429269,47.57454],[8.469198,47.605403],[8.526096,47.631749],[8.565134,47.611633],[8.573303,47.594566],[8.593054,47.600554],[8.614635,47.638194],[8.616332,47.662973],[8.581943,47.668569],[8.540554,47.664303],[8.51924,47.651309],[8.485418,47.647082],[8.449689,47.661505],[8.416722,47.67921],[8.406945,47.7018],[8.477082,47.770619],[8.562917,47.806664],[8.58969,47.805136],[8.611664,47.803882],[8.667799,47.795027],[8.685554,47.78666],[8.709574,47.7727],[8.736455,47.757074],[8.726239,47.702458],[8.754362,47.693349],[8.800134,47.681728],[8.774375,47.71597],[8.804471,47.735384],[8.835278,47.718047],[8.855833,47.698883],[8.88039,47.658885],[8.89889,47.650828],[8.925973,47.651801],[8.947774,47.657492],[8.979445,47.670136],[9.000835,47.680827],[9.033335,47.688328],[9.056899,47.686937],[9.082638,47.685414],[9.261096,47.662842],[9.478322,47.575852],[9.572112,47.538991],[9.608773,47.529515],[9.651507,47.529515],[9.69253,47.529515],[9.732794,47.541119],[9.747223,47.566679],[9.775418,47.591246],[9.803372,47.593539],[9.937198,47.546448],[9.957912,47.538249],[10.043055,47.495278],[10.231735,47.373745],[10.224614,47.355559],[10.210945,47.321595],[10.173335,47.274719],[10.228891,47.276037],[10.253569,47.283],[10.274443,47.288887],[10.318521,47.305758],[10.34272,47.318129],[10.429722,47.39611],[10.473748,47.437637],[10.469893,47.460698],[10.466182,47.482909],[10.436391,47.529163],[10.433682,47.580482],[10.481801,47.586519],[10.569445,47.540274],[10.616717,47.545576],[10.690832,47.553887],[10.909443,47.518051],[10.955042,47.438158],[10.982206,47.399495],[11.020086,47.395505],[11.104027,47.396526],[11.296389,47.428887],[11.457499,47.512215],[11.50833,47.509559],[11.554445,47.515546],[11.579863,47.524092],[11.661292,47.571932],[11.683054,47.584717],[11.76695,47.595144],[11.92,47.614164],[11.970794,47.620209],[12.006388,47.624443],[12.06,47.620552],[12.111111,47.614716],[12.141388,47.611107],[12.201557,47.612988],[12.206114,47.632607],[12.201111,47.657492],[12.319731,47.662295],[12.455,47.667771],[12.481245,47.652533],[12.514445,47.633255],[12.577089,47.64701],[12.603401,47.672287],[12.665834,47.684998],[12.736943,47.682705],[12.810264,47.633133],[12.827844,47.621246],[12.801583,47.607124],[12.788192,47.583536],[12.806664,47.554718],[12.845005,47.535016],[12.957871,47.477017],[13.01981,47.474761],[13.053336,47.497564],[13.081788,47.585931],[13.097026,47.649024],[13.071997,47.692741],[13.058336,47.706109],[13.023054,47.724164],[12.993746,47.714164],[12.913957,47.725],[12.944166,47.788746],[12.969188,47.809426],[13.008891,47.854164],[12.980324,47.88987],[12.961622,47.91231],[12.918891,47.957773],[12.860382,48.004971],[12.839394,48.028249],[12.800853,48.053499],[12.766248,48.082218],[12.759721,48.121729],[12.871246,48.202909],[13.017774,48.259436],[13.154445,48.292219],[13.24015,48.297731],[13.265075,48.30053],[13.291739,48.307729],[13.313055,48.315826],[13.334999,48.328606],[13.356457,48.342017],[13.395,48.366101],[13.422313,48.392087],[13.437918,48.429437],[13.4575,48.515554],[13.450238,48.538289],[13.443228,48.560237],[13.469502,48.568722],[13.51861,48.58458],[13.583807,48.571779],[13.602774,48.568054],[13.634598,48.558013],[13.656188,48.550383],[13.676943,48.532288],[13.725996,48.515587],[13.803749,48.582634],[13.822534,48.624659],[13.82086,48.676665],[13.814722,48.738053],[13.833609,48.773607],[13.817331,48.782887],[13.811748,48.800486],[13.780137,48.834022],[13.761665,48.845966],[13.745641,48.870098],[13.728127,48.881317],[13.699445,48.8793],[13.672219,48.889445],[13.657592,48.900261],[13.636954,48.929503],[13.62611,48.947636],[13.595345,48.957427],[13.571863,48.969922],[13.541599,48.973174],[13.509719,48.9725],[13.402545,49.006191],[13.397205,49.04185],[13.318471,49.10083],[13.173054,49.167221],[13.031111,49.287773],[12.995705,49.310933],[12.959027,49.334927],[12.887201,49.340382],[12.844762,49.340133],[12.797221,49.339859],[12.728005,49.387855],[12.674445,49.424999],[12.601072,49.52309],[12.578609,49.560554],[12.554722,49.616661],[12.515485,49.677219],[12.476861,49.690499],[12.456758,49.703739],[12.468473,49.783472],[12.511536,49.853546],[12.545973,49.909582],[12.490026,49.976501],[12.471109,49.985836],[12.429445,49.993891],[12.343777,50.031546],[12.307499,50.047493],[12.270826,50.063769],[12.206145,50.106209],[12.193819,50.136316],[12.209165,50.163609],[12.122083,50.308468],[12.099272,50.321366],[12.083958,50.333502],[11.988379,50.361931],[11.907807,50.373305],[11.812136,50.41426],[11.752229,50.573676],[11.651289,50.667158],[11.606149,50.658034],[11.570167,50.613567],[11.572583,50.504187],[11.596262,50.333502],[11.560519,50.327818],[11.463871,50.388093],[11.453759,50.416536],[11.410849,50.448401],[11.352204,50.467752],[11.254032,50.518993],[11.188677,50.528105],[11.129624,50.545192],[11.062634,50.555445],[11.089867,50.430191],[11.113589,50.38468],[11.105576,50.350559],[11.074304,50.325544],[10.972666,50.336914],[10.914663,50.401744],[10.797721,50.59419],[10.7096,50.631808],[10.630871,50.70252],[10.445365,50.833804],[10.32439,50.85094],[10.289714,50.897793],[10.267215,51.172472],[10.243838,51.226348],[10.194368,51.226348],[10.170078,51.201126],[10.139983,51.258458],[10.160416,51.338777],[10.173461,51.863558],[10.181369,51.913186],[10.192359,51.973235],[10.21205,51.988253],[10.310413,51.990564],[10.538934,52.034477],[10.613879,52.062221],[10.640403,52.129303],[10.64461,52.175594],[10.621535,52.190643],[10.568953,52.268241],[10.652644,52.430588],[10.668107,52.480508],[10.69812,52.614142],[10.728428,52.639728],[10.752216,52.683939],[10.765014,52.753789],[10.717428,52.857495],[10.720949,52.939143],[11.006662,53.024368],[11.047065,53.122532],[10.878461,53.21378],[10.813953,53.436437],[10.835103,53.526829],[10.947741,53.620841],[10.820712,53.718484],[10.827507,53.742029],[10.892793,53.82095],[10.867164,53.908638],[10.88081,53.921871],[10.818536,53.890054],[10.863609,53.916936],[10.890136,53.9543],[10.881267,53.981392],[10.880914,53.981956],[10.86139,53.993891],[10.822219,53.994164],[10.795554,53.995554],[10.777082,54.006663],[10.757362,54.035827],[10.759236,54.04381],[10.762218,54.056518],[10.801364,54.089413],[10.80139,54.089437],[10.80162,54.089446],[10.832218,54.090827],[10.834878,54.090824],[10.834881,54.090824],[10.836184,54.090822],[10.880554,54.090764],[11.015612,54.155833],[11.06,54.177218],[11.076499,54.190952],[11.093954,54.205482],[11.083727,54.292603],[11.073891,54.37639],[11.063245,54.373956],[11.044718,54.369718],[11.016945,54.369991],[10.986945,54.371936],[10.958263,54.378954],[10.968748,54.379746],[10.952516,54.382855],[10.885292,54.361943],[10.885273,54.361936],[10.86745,54.351392],[10.831873,54.330345],[10.829203,54.329042],[10.829202,54.329042],[10.827861,54.328388],[10.795,54.312354],[10.7725,54.307218],[10.709239,54.308825],[10.690554,54.3093],[10.668563,54.32326],[10.652589,54.3334],[10.624617,54.351115],[10.609718,54.360545],[10.368327,54.435554],[10.288824,54.453394],[10.124165,54.48968],[10.122623,54.48966],[10.106109,54.489436],[10.024908,54.477025],[10.006664,54.474236],[9.893328,54.45389],[9.893304,54.453894],[9.866036,54.457291],[9.865105,54.458174],[9.865105,54.458174],[9.864654,54.458603],[9.845554,54.476727],[9.845557,54.476727],[9.845556,54.476728],[9.873696,54.478017],[9.875092,54.478299],[9.893054,54.481945],[9.970554,54.5075],[10.0043,54.523736],[10.026124,54.548142],[10.027168,54.549311],[10.04,54.633073],[10.037362,54.668236],[10.013643,54.701815],[9.972009,54.760754],[9.94501,54.776571],[9.943485,54.777464],[9.902153,54.791109],[9.819798,54.787578],[9.785554,54.786109],[9.68885,54.806308],[9.660554,54.812218],[9.573369,54.824926],[9.439445,54.807982],[9.440153,54.810069],[9.440153,54.810069],[9.440155,54.810075],[9.445354,54.8254],[9.414718,54.833327],[9.377363,54.827658],[9.377281,54.827646],[9.350835,54.810553],[9.248335,54.812635],[9.230835,54.8293],[9.22889,54.849581],[9.16889,54.864999],[9.062472,54.883943],[8.927714,54.907137],[8.835092,54.91379],[8.785828,54.906108],[8.75889,54.898054],[8.713079,54.892235],[8.713079,54.892235],[8.713077,54.892235],[8.692773,54.895827]]],[[[9.414724,54.833327],[9.445356,54.825402],[9.446752,54.827145],[9.414724,54.833327]]]]},"properties":{"name":"German Federal Republic","area_km2":247662.7,"capname":"Bonn","caplong":7.1,"caplat":50.73333,"gwsdate":"1949-09-21","gwedate":"1990-10-02","gwcode":260},"links":[{"href":"https://demo.ldproxy.net/cshapes/collections/boundary/items/89?f=json","rel":"self","type":"application/geo+json","title":"This document"},{"href":"https://demo.ldproxy.net/cshapes/collections/boundary/items/89?f=jsonfgc","rel":"alternate","type":"application/vnd.ogc.fg+json;compatibility=geojson","title":"This document as JSON-FG (GeoJSON Compatibility Mode)"},{"href":"https://demo.ldproxy.net/cshapes/collections/boundary/items/89?f=csv","rel":"alternate","type":"text/csv","title":"This document as CSV"},{"href":"https://demo.ldproxy.net/cshapes/collections/boundary/items/89?f=fgb","rel":"alternate","type":"application/flatgeobuf","title":"This document as FlatGeobuf"},{"href":"https://demo.ldproxy.net/cshapes/collections/boundary/items/89?f=html","rel":"alternate","type":"text/html","title":"This document as HTML"},{"href":"https://demo.ldproxy.net/cshapes/collections/boundary/items/89?f=jsonfg","rel":"alternate","type":"application/vnd.ogc.fg+json","title":"This document as JSON-FG"},{"href":"https://demo.ldproxy.net/cshapes/collections/boundary?f=json","rel":"collection","type":"application/json","title":"The collection the feature belongs to"}]}]};

const EU_CC_DICT = {
	// czechoslovakia
	'cz': 'cs', // czechia
	'sk': 'cs', // slovakia

	// yugoslavia
	'si': 'yu', // slovenia
	'hr': 'yu', // croatia
	'rs': 'yu', // serbia
	'ba': 'yu', // bosnia
	'xk': 'yu', // kosovo
	'me': 'yu', // montenegro
	'mk': 'yu', // north macedonia

	// soviet union
	'ru': 'su', // russia
	'ee': 'su', // estonia
	'lv': 'su', // latvia
	'lt': 'su', // lithuania
	'by': 'su', // belarus
	'ua': 'su', // ukraine
	'md': 'su', // moldova
	'ge': 'su', // georgia
	'kg': 'su', // kyrgyzstan
	'uz': 'su', // uzbekistan
	'tj': 'su', // tajikistan
	'am': 'su', // armenia
	'az': 'su', // azerbaijan
	'tm': 'su', // turkmenistan
	'kz': 'su', // kazakhstan
}

const EU_NAME_DICT = {
	'cs': 'Czechoslovakia',
	'yu': 'Yugoslavia',
	'su': 'Soviet Union',
}

function checkPolygons(osm) {
	if(!turf) throw new Error("Cannot find required Turf.js library");
	if(osm.address.country_code !== 'de') return null;

	const pos = {lat: osm.lat, lng: osm.lon};

	let features = [];

	if(CUSTOM_POLYGONS) {
		let customFeatures = CUSTOM_POLYGONS?.features;
		if(!customFeatures) throw new Error("Invalid `CUSTOM_POLYGONS` GeoJSON data.");
		features = features.concat(customFeatures);
	}

	if(features.length === 0) throw new Error("No GeoJSON polygons provided.");

	for(let i = 0; i < features.length; i++) {
		const poly = features[i]?.geometry?.coordinates;
		if(!poly) throw new Error("Invalid GeoJSON data.");

		const turfPoint = turf.helpers.point([pos.lng, pos.lat])
		const turfPoly = turf.helpers.multiPolygon(poly)
		const turfMatch = turf.booleanPointInPolygon(turfPoint, turfPoly)

		if(turfMatch) {
			return {
				name: features[i]?.properties?.name,
				index: i
			};
		}
	}

	return null;
}

function countryMatch(osm, poly) {
	if(poly) {
		return {
			name: poly.name,
			id: poly.name
		}
	}

	const cc = EU_CC_DICT[osm.address.country_code] || osm.address.country_code;
	const name = EU_NAME_DICT[cc] || osm.address.country;

	return {
		name: name,
		id: cc
	}
}

function customMatch(state, guess, location) {
	const guess_poly = checkPolygons(guess);
	const location_poly = checkPolygons(location);

	const guess_match = countryMatch(guess, guess_poly);
	const location_match = countryMatch(location, location_poly);

	return {
		player_guess_name: guess_match?.name || 'Undefined',
		actual_location_name: location_match?.name || 'Undefined',
		match: guess_match && location_match && guess_match?.id == location_match?.id
	}
}

const GSF = new GeoGuessrStreakFramework({
	storage_identifier: 'MW_GeoGuessrPostWarEuropeCountryStreak',
	name: 'Country Streak',
	terms: {
		single: 'country',
		plural: 'countries'
	},
	enabled_on_challenges: CHALLENGE,
	automatic: AUTOMATIC,
	language: LANGUAGE,
	query_openstreetmap: true,
	custom_match_function: customMatch,
	keyboard_shortcuts: KEYBOARD_SHORTCUTS,
});